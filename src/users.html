{% set title = 'Users' %}
{% set filename = 'users.html' %}

{% extends 'src/layouts/master.html' %}

{% block content %}
<div class="page-heading">
  <h3>Users</h3>
</div>
<div class="page-content">
  <section class="row">
    <div class="col-12">
      <button id="users-list" class="btn btn-primary mb-3">List Users</button>
      <pre id="users-data"></pre>
      <hr/>
      <h5>Create</h5>
      <form id="users-create" class="mb-3">
        <textarea id="users-create-json" class="form-control" rows="3" placeholder='{"name":"Example"}'></textarea>
        <button type="submit" class="btn btn-success mt-2">Create</button>
      </form>
      <h5>Update</h5>
      <form id="users-update" class="mb-3">
        <input id="users-update-id" class="form-control mb-2" placeholder="ID"/>
        <textarea id="users-update-json" class="form-control" rows="3" placeholder='{"name":"Updated"}'></textarea>
        <button type="submit" class="btn btn-warning mt-2">Update</button>
      </form>
      <h5>Delete</h5>
      <form id="users-delete">
        <input id="users-delete-id" class="form-control mb-2" placeholder="ID"/>
        <button type="submit" class="btn btn-danger">Delete</button>
      </form>
    </div>
  </section>
</div>
{% endblock %}

{% block js %}
<script type="module">
import { get, post, put, del } from './assets/js/api.js';

const base = '/users';
const output = document.getElementById('users-data');

function refresh() {
  get(base).then(data => {
    output.textContent = JSON.stringify(data, null, 2);
  }).catch(err => console.error(err));
}

document.getElementById('users-list').addEventListener('click', e => {
  e.preventDefault();
  refresh();
});

document.getElementById('users-create').addEventListener('submit', e => {
  e.preventDefault();
  try {
    const payload = JSON.parse(document.getElementById('users-create-json').value || '{}');
    post(base, payload).then(refresh);
  } catch (err) {
    console.error(err);
  }
});

document.getElementById('users-update').addEventListener('submit', e => {
  e.preventDefault();
  const id = document.getElementById('users-update-id').value;
  try {
    const payload = JSON.parse(document.getElementById('users-update-json').value || '{}');
    put(`${base}/${id}`, payload).then(refresh);
  } catch (err) {
    console.error(err);
  }
});

document.getElementById('users-delete').addEventListener('submit', e => {
  e.preventDefault();
  const id = document.getElementById('users-delete-id').value;
  del(`${base}/${id}`).then(refresh).catch(err => console.error(err));
});

refresh();
</script>
{% endblock %}
